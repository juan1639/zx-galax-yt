org	$8000

;==========================================================================
;---			C O M I E N Z O   P R O G R A M A		---
;---									---
;---      		    CLS + ATRIBUTOS GENERALES                   ---
;--------------------------------------------------------------------------
call	sub_cls
call 	sub_cls_attr

;==========================================================================
;---                                                                    ---
;---	               B U C L E    P R I N C I P A L                   ---
;---                                                                    ---
;==========================================================================
bucle_principal:
	call 	dibuja_nave
	
jr	bucle_principal
jr	$

;==========================================================================
;=====                                                                =====
;=====                        S U B R U T I N A S                     =====
;=====                                                                =====
;==========================================================================
;---		             SUB - DIBUJA NAVE                          ---
;---                                                                    ---
;---  HL---> Coordenadas Jugador        ...  B---> Bucle Scanlines      ---
;---  DE---> Puntero direcciones Sprite ...  				---
;==========================================================================
dibuja_nave:
	ld	hl,$4000
	ld	de,sprites

	ld	b,$10

	bucle_dibuja_nave:
	ld	a,(de)
	ld	(hl),a

	inc	l
	inc	de

	ld	a,(de)
	ld	(hl),a

	dec	l

	call	check_next_fila

	inc	de
	
	djnz	bucle_dibuja_nave
	ret

check_next_fila:
	ld	a,h
	and	%00000111
	cp	%00000111 ; $07 decimal 7
	jr	nz, next_scanline

	ld	a,h
	xor	%00000111
	ld	h,a

	ld	a,l
	add	a,$20
	ld	l,a
	ret

	next_scanline:
	inc	h	
	ret

;===========================================================================
;---                    SUB - L E E R   T E C L A D O                    ---
;---                                                                     ---  
;---         Izquierda --------> 'Z' o Cursor JoyStick Izquierda         	---
;---         Derecha ----------> 'X' o Cursor JoyStick Derecha           ---
;---         Disparo ----------> 'Spc' o Cursor JoyStick Arriba          ---
;---------------------------------------------------------------------------


;===========================================================================
;---                    S U B - ATRIBUTOS GENERALES                      ---
;---------------------------------------------------------------------------


;===========================================================================
;---                    S U B - C L S  ATRIBUTOS                         ---
;---------------------------------------------------------------------------
sub_cls_attr:

; flash 0 ----- bit 0
; bright 0 ---- bit 1
; paper 1  ---- bits 2,3,4
; ink 6 ------- bits 5,6,7

	ld	a,%00001110
	ld	hl,$5800
	ld	(hl),a
	ld	de,$5801
	ld	bc,$02ff
	ldir
ret

;==========================================================================
;---		               SUB -  C L S                             ---
;--------------------------------------------------------------------------
sub_cls:
	ld	a,$00
	ld	hl,$4000
	ld	(hl),a
	ld	de,$4001
	ld	bc,$17ff
	ldir
ret

;=============================================================================
;---                                                                       ---
;---                           S P R I T E S                               ---
;---                                                                       ---
;-----------------------------------------------------------------------------
sprites:
DEFB	  1,128,  3,192,  7,224, 15,240
DEFB	 15,240,  9,144, 73,146, 65,130
DEFB	229,167,237,183,253,191,252, 63
DEFB	246,111,230,103,224,  7, 64,  2

;-----------------------------------------------------------------------------
;---		    V A R I A B L E S  en  M E M O R I A                   ---
;-----------------------------------------------------------------------------

end	$8000

